<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Monitoring Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f4f4f4;
        }
        .slow-domains {
            color: red;
        }
    </style>
</head>
<body>
    <h1>Job Monitoring Dashboard</h1>
    <div id="dashboard">
        Loading metrics...
    </div>
    <script>
        // Fetch and display the JSON metrics
        async function loadMetrics() {
            try {
                const response = await fetch('job_metrics.json');
                const data = await response.json();
                const dashboard = document.getElementById('dashboard');
                let html = '<table><thead><tr>' +
                           '<th>Job ID</th><th>Status</th><th>Log Time</th><th>Log Step</th>' +
                           '<th>Model Start</th><th>Model End</th><th>Elapsed Time (Hours)</th>' +
                           '<th>Current Time Step</th><th>Average Time Per Domain</th><th>Slow Domains</th>' +
                           '</tr></thead><tbody>';
                for (const [jobId, details] of Object.entries(data)) {
                    html += `<tr>
                        <td>${jobId}</td>
                        <td>${details.status}</td>
                        <td>${details.log_time}</td>
                        <td>${details.log_step}</td>
                        <td>${details.model_start_date}</td>
                        <td>${details.model_end_date}</td>
                        <td>${details.elapsed_time_hours.toFixed(2)}</td>
                        <td>${details.current_time_step}</td>
                        <td>`;
                    for (const [domain, avgTime] of Object.entries(details.average_elapsed_time_per_domain)) {
                        html += `Domain ${domain}: ${avgTime.toFixed(4)}s<br>`;
                    }
                    html += `</td><td class="${details.slow_domains.length > 0 ? 'slow-domains' : ''}">` +
                            `${details.slow_domains.length > 0 ? details.slow_domains.join(', ') : 'None'}` +
                            `</td></tr>`;
                }
                html += '</tbody></table>';
                dashboard.innerHTML = html;
            } catch (error) {
                console.error('Error loading metrics:', error);
                document.getElementById('dashboard').innerHTML = 'Failed to load metrics.';
            }
        }
        loadMetrics();
    </script>
</body>
</html>